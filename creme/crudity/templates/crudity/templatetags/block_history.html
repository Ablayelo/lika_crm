{% load i18n %}
{% load media %}
{% load creme_block creme_core_tags creme_widgets %}
{% load crudity_tags %}
<style type="text/css">
    {% comment %}Generify this{% endcomment %}
    .type_header_block
    {
        background: url({% get_image_path_for_ctype email_ct 'normal' %}) no-repeat;
        width: 48px;
        height:48px;
    }
</style>
{% with 6 as colspan %}
    <table class="table_detail_view ui-corner-all {{ state.classes }}" id={{block_name}}>
        {% get_block_header colspan=colspan %}
            <th style="width: 80%;" class="collapser" align="left">
                <table cellspacing="0" cellpadding="0">
                    <tbody>
                        <tr>
                            <th class="type_header_block">{% get_image_for_ctype ct 'small' %}
                                </th>
                            <th>{% blocktrans count page.paginator.count as counter with ct.name as ct_name %}{{counter}} History item - {{ct_name}}{% plural %}{{counter}} History items - {{ct_name}}{% endblocktrans %}</th>
                        </tr>
                    </tbody>
                </table>
            </th>
            <th style="width: 20%;" align="right">
                <div class="buttons"></div>
            </th>
        {% end_get_block_header %}
{#        <thead>#}
{#            <tr>#}
{#                <th colspan="{{colspan}}">#}
{#                    {% blocktrans count page.paginator.count as counter with ct.name as ct_name and type|get_crud_type_verbose as type %}{{counter}} History item - {{ct_name}} - {{type}}{% plural %}{{counter}} History items - {{ct_name}} - {{type}}{% endblocktrans %}#}
{#                </th>#}
{#            </tr>#}
{#        </thead>#}
        <tbody class="collapsable">
            {% if page.paginator.count %}
                <tr class="header">
                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %}">{% trans "Entity" %}</th>
                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %}">{% trans "Created" %}</th>
                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %}">{% trans "Action" %}</th>
                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %}">{% trans "Source" %}</th>
                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %}">{% trans "Description" %}</th>
                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %} action">{% trans "View entity's file" %}</th>
                </tr>
                {% for history in page.object_list %}<!--{% cycle "block_line_dark" "block_line_light" as row_color %}-->
                    <tr class="content">
                        {% with history.get_entity as history_entity %}
                            <td class="{{row_color}}">{{history_entity|allowed_unicode:user}}</td>
                            <td class="{{row_color}}">{{history.created}}</td>
                            <td class="{{row_color}}">{{history.action}}</td>
                            <td class="{{row_color}}">{{history.source}}</td>
                            <td class="{{row_color}}">{{history.description}}</td>
                            <td class="{{row_color}} action"><a href="{{history_entity.get_absolute_url}}"><img src="{% media_url 'images/view_22.png' %}" border="0" title="{% blocktrans %}View '{{history_entity}}' details{% endblocktrans %}" alt="{% trans "View" %}" /></a></td>
                        {% endwith %}
                    </tr>
                {% endfor %}
            {% else %}
                <tr class="content empty">
                    <td class="block_line_dark">{% blocktrans with ct.name as ct_name %}No waiting action for {{ct_name}}{% endblocktrans %}</td>
                </tr>
            {% endif %}
        </tbody>
        {% include 'creme_core/templatetags/widgets/block_footer.html' %}
    </table>
{% endwith %}
