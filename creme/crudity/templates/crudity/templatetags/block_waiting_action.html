{% load i18n %}
{% load media %}
{% load creme_block creme_core_tags creme_widgets %}
{% load crudity_tags %}
{% with 3 as colspan %}
    <style type="text/css">
        {% comment %}Generify this{% endcomment %}
        .email_header_block
        {
            background: url({% get_image_path_for_ctype email_ct 'normal' %}) no-repeat;
            width: 48px;
            height:48px;
        }

        .email_header_block img
        {
            float: right;
            position: relative;
            top: 14px;
        }
    </style>
    <table class="table_detail_view ui-corner-all {{ state.classes }}" id={{block_name}}>
    {% get_block_header colspan=3 %}
        <th style="width: 80%;" class="collapser" align="left">
            <table cellspacing="0" cellpadding="0">
                <tbody>
                    <tr>
                        <th class="email_header_block">{% get_image_for_ctype waiting_ct 'small' %}
                            </th>
                        <th>{% blocktrans count counter=page.paginator.count with waiting_ct.name as ct_name and waiting_type|get_crud_type_verbose as type %}{{counter}} Waiting action - {{ct_name}} - {{type}}{% plural %}{{counter}} Waiting actions - {{ct_name}} - {{type}}{% endblocktrans %}</th>
                    </tr>
                </tbody>
            </table>
        </th>
        <th style="width: 20%;" align="right"></th>
    {% end_get_block_header %}
        <tbody class="collapsable">
            {% if page.paginator.count %}
                <tr>
                    <th colspan="{{colspan}}" class="block_header_line_dark" align="left">
                        <a class="button_link" onclick="creme.emails.mass_action('/crudity/waiting_actions/validate', '[name=select_one]:checked', {% get_block_reload_uri %});">
                            <img src="{% media_url 'images/jewel_ok_22.png' %}" border="0" title="{% trans "Validate" %}" alt="{% trans "Validate" %}" />
                            {% trans "Validate" %}
                        </a>
                        <a class="button_link" onclick="creme.emails.mass_action('/crudity/waiting_actions/delete', '[name=select_one]:checked', {% get_block_reload_uri %});">
                            <img src="{% media_url 'images/delete_22.png' %}" border="0" title="{% trans "Delete" %}" alt="{% trans "Delete" %}" />
                            {% trans "Delete" %}
                        </a>
                    </th>
                </tr>
                <tr>
                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %}">
                        <center><input name="select_all" value="all" type="checkbox" title="{% trans "Select all" %}" onclick="creme.utils.toggleCheckallState(this, '#{{block_name}} [name=select_one]');"/></center>
                    </th>
                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %}">{% trans "Data" %}</th>
                    <th class="{% cycle "block_header_line_dark" "block_header_line_light" %}">{% trans "Actions" %}</th>
                </tr>
                {% for waiting_action in page.object_list %}<!--{% cycle "block_line_dark" "block_line_light" as row_color %}-->
                    <tr>
                        <td class="{{row_color}}">
                            <center><input name="select_one" value="{{waiting_action.pk}}" type="checkbox" onclick="creme.utils.autoCheckallState (this, '#{{block_name}} [name=select_all]', '#{{block_name}} [name=select_one]');"/></center>
                        </td>
                        <td class="{{row_color}}">
                            {% for k, v in waiting_action.get_data.items %}
                                {% if forloop.counter0|mod:4 == 0 %}
                                <p>
                                {% else %}
                                 /
                                {% endif %}
                                {{k}} : {{v}}
                                {% if forloop.counter|mod:4 == 0 %}
                                    </p>
                                {% endif %}
                            {% endfor %}
                        </td>
                        <td class="{{row_color}}" align="center" valign="center" style="width:10%;">
                            {% get_line_deletor at_url '/crudity/waiting_actions/delete' with_args "{'ids': ['{{waiting_action.pk}}'] }" with_perms 1 %}
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td class="block_line_dark">{% blocktrans with type=waiting_type|get_crud_type_verbose ct_name=waiting_ct.name %}No waiting action for {{type}} {{ct_name}}{% endblocktrans %}</td>
                </tr>
            {% endif %}
        </tbody>
        {% include 'creme_core/templatetags/widgets/block_footer.html' %}
    </table>
{% endwith %}
